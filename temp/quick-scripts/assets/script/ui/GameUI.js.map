{"version":3,"sources":["GameUI.js"],"names":["cc","Class","extends","Component","properties","_scrolling","groundNodes","Node","mapNode","levelPrefab","Prefab","congratPrefab","playerNode","logoNode","infoNode","headIcon","Sprite","nickName","Label","highestScore","bgNode","tipNode","aboutNode","scoreNode","overNode","scoreLabel","_score","_scoreMax","retryBtn","Button","_subTexture","subSprite","showRankBtn","hideRankBtn","blockNode","onLoad","log","initCollision","scale","node","on","onRetryBtn","sys","localStorage","getItem","once","EventType","TOUCH_START","showGuide","TOUCH_MOVE","onTouchMove","gameStart","runAction","repeatForever","blink","active","GameApp","data","user","nickname","string","UTILS","addPreZero","headimgurl","initNetImage","scaleTo","config","window","a","obstacleConfig","params","sound","playMusic","pool","initPool","isWeiXinMiniGame","wx","postMessage","message","sharedCanvas","width","game","canvas","height","Texture2D","onDisable","unregisterEvents","registerEvents","ui","gameOver","levelNext","gameEnd","off","manager","director","getCollisionManager","enabled","showPopup","event","stopAllActions","opacity","fadeOut","moveBy","v2","sequence","delayTime","getComponent","run","level","newLevel","gameFinish","stand","children","score","toShareUrl","scheduleOnce","showUI","playEffect","shake","die","rotateBy","moveTo","callFunc","shoot","firework","touchPos","convertTouchToNodeSpace","currentTouch","pos","x","y","Math","min","max","position","refreshScore","Object","keys","length","levelScore","update","delta","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","move","mapVelocity","i","player","Animation","currentClip","_name","instantiate","parent","getScore","init","emit","duration","range","interval","time","schedule","random"],"mappings":"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","file":"GameUI.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 背景\r\n        _scrolling: false,\r\n        groundNodes: [cc.Node],\r\n        // 怪物\r\n        mapNode: cc.Node,\r\n        levelPrefab: cc.Prefab,\r\n        congratPrefab: cc.Prefab,\r\n        // 玩家\r\n        playerNode: cc.Node,\r\n        // UI\r\n        logoNode: cc.Node,\r\n        infoNode: cc.Node,\r\n        headIcon: cc.Sprite,//头像\r\n        nickName: cc.Label,//昵称\r\n        highestScore: cc.Label,//历史最高分\r\n        bgNode: cc.Node,\r\n        tipNode: cc.Node,\r\n        aboutNode: cc.Node,\r\n        scoreNode: cc.Node,\r\n        overNode: cc.Node,\r\n\r\n        scoreLabel: cc.Label,\r\n        _score: 0,\r\n        _scoreMax: false,\r\n        retryBtn: cc.Button,\r\n\r\n        // 微信小游戏子域\r\n        _subTexture: null,\r\n        subSprite: cc.Sprite,\r\n        showRankBtn: cc.Button,\r\n        hideRankBtn: cc.Button,\r\n        blockNode: cc.Node,\r\n    },\r\n\r\n    onLoad() {\r\n        cc.log('GameUI onLoad');\r\n        // 开启碰撞检测\r\n        this.initCollision();\r\n        // UI\r\n        this.infoNode.scale = 0;\r\n        this.retryBtn.node.on('click', this.onRetryBtn, this);\r\n        // 游戏\r\n        this._scrolling = false;\r\n        // 按住开始\r\n        if (!cc.sys.localStorage.getItem('GUIDED')) {\r\n            this.playerNode.once(cc.Node.EventType.TOUCH_START, this.showGuide, this);\r\n        }\r\n        else {\r\n            this.playerNode.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n            this.playerNode.once(cc.Node.EventType.TOUCH_START, this.gameStart, this);\r\n        }\r\n        this.tipNode.runAction(cc.repeatForever(cc.blink(0.7, 1)));\r\n        this.playerNode.active = false;\r\n        this.tipNode.active = false;\r\n\r\n        if (GameApp.data.user && GameApp.data.user.nickname) {\r\n            this.nickName.string = GameApp.data.user.nickname;\r\n        }\r\n        if (GameApp.data.user && GameApp.data.user.highestScore) {\r\n            this.highestScore.string = UTILS.addPreZero(GameApp.data.user.highestScore, 4);\r\n        }\r\n        if (GameApp.data.user && GameApp.data.user.headimgurl) {\r\n            UTILS.initNetImage(GameApp.data.user.headimgurl, this.headIcon);\r\n        }\r\n        this.infoNode.runAction(cc.scaleTo(0.2, 1));\r\n\r\n\r\n        // 获取配置\r\n        GameApp.data.config = window.a.obstacleConfig;\r\n        GameApp.data.params = window.a;\r\n\r\n        this.playerNode.active = true;\r\n        this.tipNode.active = true;\r\n        this.aboutNode.active = true;\r\n        \r\n        // 播放音乐\r\n        GameApp.sound.playMusic('game');\r\n        //初始化对象池\r\n        GameApp.pool.initPool();\r\n\r\n        //微信小游戏用到的渲染区域\r\n        if (UTILS.isWeiXinMiniGame()) {\r\n            this.showRankBtn.node.on('click', ()=>{\r\n                wx.postMessage({\r\n                    message: 'ShowRank'\r\n                });\r\n                this.showRankBtn.node.active = false;\r\n                this.blockNode.active = true;\r\n                this.hideRankBtn.node.active = true;\r\n            });\r\n            this.hideRankBtn.node.on('click', ()=>{\r\n                wx.postMessage({\r\n                    message: 'HideRank'\r\n                });\r\n                this.showRankBtn.node.active = true;\r\n                this.blockNode.active = false;\r\n                this.hideRankBtn.node.active = false;\r\n            });\r\n\r\n            sharedCanvas.width = cc.game.canvas.width * 2;\r\n            sharedCanvas.height = cc.game.canvas.height * 2;\r\n            this._subTexture = new cc.Texture2D();\r\n            this.subSprite.node.active = true;\r\n\r\n            this.showRankBtn.node.active = true;\r\n            this.blockNode.active = false;\r\n            this.hideRankBtn.node.active = false;\r\n            wx.postMessage({\r\n                message: 'Refresh'\r\n            });\r\n        }\r\n    },\r\n\r\n    onDisable() {\r\n        this.unregisterEvents();\r\n    },\r\n\r\n    registerEvents() {\r\n        GameApp.ui.node.on('GAME_OVER', this.gameOver, this);\r\n        GameApp.ui.node.on('LEVEL_NEXT', this.levelNext, this);\r\n        GameApp.ui.node.on('GAME_END', this.gameEnd, this);\r\n    },\r\n\r\n    unregisterEvents() {\r\n        GameApp.ui.node.off('GAME_OVER', this.gameOver, this);\r\n        GameApp.ui.node.off('LEVEL_NEXT', this.levelNext, this);\r\n        GameApp.ui.node.off('GAME_END', this.gameEnd, this);\r\n    },\r\n\r\n    initCollision() {\r\n        let manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        // manager.enabledDebugDraw = true;\r\n    },\r\n\r\n    showGuide() {\r\n        GameApp.ui.showPopup('GuidePopup');\r\n        this.playerNode.on(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.playerNode.once(cc.Node.EventType.TOUCH_START, this.gameStart, this);\r\n    },\r\n\r\n    gameStart(event) {\r\n        // 隐藏排行榜\r\n        if (UTILS.isWeiXinMiniGame()) {\r\n            this.subSprite.node.active = false;\r\n        }\r\n        // 监听事件\r\n        this.registerEvents();\r\n        // UI\r\n        this.tipNode.stopAllActions();\r\n        this.tipNode.opacity = 255;\r\n        this.tipNode.runAction(cc.fadeOut(0.5));\r\n        this.aboutNode.active = false;\r\n        this.logoNode.runAction(cc.moveBy(0.5, cc.v2(0, 1000)));\r\n        this.infoNode.runAction(cc.moveBy(0.5, cc.v2(0, 1000)));\r\n        this.scoreNode.active = true;\r\n        this.scoreNode.runAction(cc.sequence(\r\n            cc.delayTime(1),\r\n            cc.moveBy(1, cc.v2(0, -this.scoreNode.height))\r\n        ));\r\n        // 地图\r\n        this._scrolling = true;\r\n        // 玩家\r\n        this.playerNode.getComponent('Player').run();\r\n        this.onTouchMove(event);\r\n        // 刷新怪物\r\n        GameApp.data.level = 1;\r\n        this.newLevel();\r\n    },\r\n\r\n    gameFinish() {\r\n        // 注销事件\r\n        this.unregisterEvents();\r\n        // 停止游戏\r\n        this._scrolling = false;\r\n        this.playerNode.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        this.playerNode.getComponent('Player').stand();\r\n        for (let level of this.mapNode.children) {\r\n            level.getComponent('Level')._scrolling = false;\r\n        }\r\n\r\n        // 上传微信\r\n        if (UTILS.isWeiXinMiniGame()) {\r\n            wx.postMessage({\r\n                message: 'UpdateScore',\r\n                score: this._score,\r\n            });\r\n        }\r\n        // 更新本地最高分\r\n        if (GameApp.data.user && this._score > GameApp.data.user.highestScore) {\r\n            GameApp.data.user.highestScore = this._score;\r\n        }\r\n    },\r\n\r\n    toShareUrl() {\r\n        this.scheduleOnce(() => {\r\n            GameApp.ui.showUI('GameUI');\r\n        }, 3);\r\n    },\r\n\r\n    gameOver() {\r\n        GameApp.sound.playEffect('lose');\r\n        this.shake(0.2, 10);\r\n        this.gameFinish();\r\n\r\n        this.playerNode.getComponent('Player').die();\r\n        this.overNode.runAction(cc.sequence(\r\n            cc.delayTime(1),\r\n            cc.rotateBy(0.3, 180),\r\n            cc.rotateBy(0.1, -10),\r\n            cc.rotateBy(0.1, 10),\r\n        ));\r\n        this.toShareUrl();\r\n    },\r\n\r\n    gameEnd() {\r\n        this.gameFinish();\r\n\r\n        this.playerNode.getComponent('Player').run();\r\n        this.playerNode.runAction(cc.sequence(\r\n            cc.moveTo(0.6, cc.v2(0, -460)),\r\n            cc.callFunc(() => {\r\n                this.playerNode.getComponent('Player').stand();\r\n                this.playerNode.getComponent('Player').shoot();\r\n            }),\r\n            cc.delayTime(0.6),\r\n            cc.callFunc(() => {\r\n                this.firework();\r\n            }),\r\n            cc.delayTime(1),\r\n            cc.callFunc(() => {\r\n                this.toShareUrl();\r\n            })\r\n        ));\r\n    },\r\n\r\n    onRetryBtn() {\r\n        GameApp.ui.showUI('GameUI');\r\n    },\r\n\r\n    onTouchMove(event) {\r\n        let touchPos = this.node.convertTouchToNodeSpace(event.currentTouch);\r\n        let pos = cc.v2(touchPos.x - this.node.width / 2, touchPos.y - this.node.height / 2);\r\n        pos.x = Math.min(315, Math.max(-315, pos.x));\r\n        pos.y = Math.min(505, Math.max(-635, pos.y));\r\n        this.playerNode.position = pos;\r\n    },\r\n\r\n    refreshScore(score) {\r\n        if (score < this._score || this._scoreMax) {\r\n            return;\r\n        }\r\n        this._score = score;\r\n        this.scoreLabel.string = this._score + 'M';\r\n        // 获得满分时\r\n        if (this._score >= Object.keys(GameApp.data.config.level).length * GameApp.data.levelScore()) {\r\n            this._scoreMax = true;\r\n            cc.log('满分啦！！！');\r\n            this.playerNode.off(cc.Node.EventType.TOUCH_MOVE, this.onTouchMove, this);\r\n        }\r\n    },\r\n\r\n    levelNext() {\r\n        GameApp.data.level++;\r\n        this.newLevel();\r\n    },\r\n\r\n    update(delta) {\r\n        if (this._subTexture && this.subSprite.node.active) {\r\n            this._subTexture.initWithElement(sharedCanvas);\r\n            this._subTexture.handleLoadedTexture();\r\n            this.subSprite.spriteFrame = new cc.SpriteFrame(this._subTexture);\r\n        }\r\n\r\n        if (!this._scrolling) {\r\n            return;\r\n        }\r\n        // 滚动背景\r\n        let move = -delta * GameApp.data.mapVelocity();\r\n        for (let i = 0; i < 2; i++) {\r\n            this.groundNodes[i].y += move;\r\n            if (this.groundNodes[i].y < -1280) {\r\n                // 隐藏背景\r\n                if (this.bgNode.active) {\r\n                    this.bgNode.active = false;\r\n                }\r\n                this.groundNodes[i].y = 1280;\r\n                this.groundNodes[1 - i].y = 0;\r\n                break;\r\n            }\r\n        }\r\n        // 达到最高分\r\n        if (this._scoreMax) {\r\n            this.playerNode.y -= delta * GameApp.data.mapVelocity();\r\n            let player = this.playerNode.getComponent('Player');\r\n            if (player.playerNode.getComponent(cc.Animation).currentClip._name !== 'stand') {\r\n                // 玩家站立，获胜！\r\n                GameApp.sound.playEffect('win');\r\n                player.stand();\r\n                for (let i = 0; i < 3; i++) {\r\n                    this.scheduleOnce(() => {\r\n                        let node = cc.instantiate(this.congratPrefab);\r\n                        node.y = this.playerNode.y + 250 * i;\r\n                        node.parent = this.node;\r\n                    }, i * 0.3);\r\n                }\r\n            }\r\n        }\r\n        // 更新分数\r\n        for (let level of this.mapNode.children) {\r\n            let score = level.getComponent('Level').getScore(this.playerNode.y);\r\n            this.refreshScore(score);\r\n        }\r\n        // 检查人物是否出屏幕\r\n        if (this.playerNode.x < -360 || this.playerNode.x > 360 || this.playerNode.y < -640 || this.playerNode.y > 640) {\r\n            this.playerNode.position = cc.v2(0, -524.6);\r\n        }\r\n    },\r\n\r\n    newLevel() {\r\n        let node = cc.instantiate(this.levelPrefab);\r\n        node.getComponent('Level').init(GameApp.data.level);\r\n        node.parent = this.mapNode;\r\n    },\r\n\r\n    firework() {\r\n        GameApp.ui.node.emit('FIREWORK');\r\n    },\r\n\r\n    // 抖动画面\r\n    shake(duration, range) {\r\n        let interval = 0.01;\r\n        let time = duration / interval;\r\n        let i = 0;\r\n        this.schedule(() => {\r\n            i++;\r\n            if (i === time + 1) {\r\n                this.node.position = cc.v2(0, 0);\r\n                cc.log('reset');\r\n            }\r\n            else {\r\n                this.node.position = cc.v2((Math.random() - 0.5) * 2 * range, (Math.random() - 0.5) * 2 * range);\r\n            }\r\n        }, interval, time);\r\n    },\r\n});\r\n"]}
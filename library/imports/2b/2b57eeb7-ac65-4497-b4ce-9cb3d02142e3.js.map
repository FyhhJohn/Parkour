{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\core/assets\\script\\core\\UI.js"],"names":["PREFAB_PATH","LoginUI","GameUI","GuidePopup","cc","Class","extends","Component","properties","uiRoot","Node","fixedRoot","popupRoot","toastRoot","toastPrefab","Prefab","loadingMask","_Prefabs","default","onLoad","GameApp","ui","node","destroy","game","addPersistRootNode","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","hideLoadingMask","emit","load","name","cb","warn","loader","loadRes","err","prefab","bind","loadAll","cbProgress","cbComplete","paths","push","loadResArray","completedCount","totalCount","prefabs","names","Object","keys","i","showFixed","getChildByName","active","instantiate","addChild","hideFixed","showUI","removeAllChildren","children","length","tag","removeFromParent","getComponent","onUIChanged","currentUI","showPopup","clean","getPopup","popPopup","popups","clearPopup","clearPopups","showToast","s","moveUp","show","showLoadingMask","event","keyCode","KEY","back","escape","childrenCount","end","closeBtn"],"mappings":"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","file":"UI.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\core","sourcesContent":["const PREFAB_PATH = {\r\n    LoginUI: 'prefab/LoginUI',\r\n    GameUI: 'prefab/GameUI',\r\n    GuidePopup: 'prefab/GuidePopup',\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        uiRoot: cc.Node,\r\n        fixedRoot: cc.Node,\r\n        popupRoot: cc.Node,\r\n        toastRoot: cc.Node,\r\n        toastPrefab: cc.Prefab,\r\n        loadingMask: cc.Node,\r\n\r\n        _Prefabs: {\r\n            default: {},\r\n        },\r\n    },\r\n\r\n    onLoad: function () {\r\n        if (GameApp.ui !== null) {\r\n            return this.node.destroy();\r\n        }\r\n        GameApp.ui = this;\r\n        cc.game.addPersistRootNode(this.node);\r\n\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        this.hideLoadingMask();\r\n\r\n        GameApp.emit('UI_READY');\r\n    },\r\n\r\n    load: function (name, cb) {\r\n        if (!PREFAB_PATH[name]) {\r\n            return cc.warn(name + '未定义！')\r\n        }\r\n        cc.loader.loadRes(PREFAB_PATH[name], function (err, prefab) {\r\n            this._Prefabs[name] = prefab;\r\n            cb(name);\r\n        }.bind(this));\r\n    },\r\n\r\n    loadAll: function (cbProgress, cbComplete) {\r\n        let paths = [];\r\n        for (let name in PREFAB_PATH) {\r\n            if (!PREFAB_PATH[name]) {\r\n                return cc.warn(name + '未定义！')\r\n            }\r\n            paths.push(PREFAB_PATH[name]);\r\n        }\r\n        cc.loader.loadResArray(paths, function (completedCount, totalCount) {\r\n            cbProgress(completedCount, totalCount);\r\n        }, function (err, prefabs) {\r\n            let names = Object.keys(PREFAB_PATH);\r\n            for (let i in prefabs) {\r\n                this._Prefabs[names[i]] = prefabs[i];\r\n            }\r\n            cbComplete();\r\n        }.bind(this));\r\n    },\r\n\r\n    showFixed(name, cb) {\r\n        //未加载\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showFixed(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n        //已实例化\r\n        let node = this.fixedRoot.getChildByName(name);\r\n        if (node) {\r\n            return node.active = true;\r\n        }\r\n        //未实例化\r\n        node = cc.instantiate(this._Prefabs[name]);\r\n        this.fixedRoot.addChild(node);\r\n        if (cb) {\r\n            cb(node);\r\n        }\r\n    },\r\n\r\n    hideFixed(name) {\r\n        let node = this.fixedRoot.getChildByName(name);\r\n        if (node) {\r\n            node.active = false;\r\n        }\r\n    },\r\n\r\n    showUI: function (name, cb) {\r\n        //未加载\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showUI(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n        //已加载\r\n        this.uiRoot.removeAllChildren();\r\n        for (let i = this.popupRoot.children.length - 1; i >= 0; i--) {\r\n            if (this.popupRoot.children[i].tag !== 10086) {\r\n                this.popupRoot.children[i].removeFromParent();\r\n            }\r\n        }\r\n        let node = cc.instantiate(this._Prefabs[name]);\r\n        this.uiRoot.addChild(node);\r\n        if (cb) {\r\n            cb(node);\r\n        }\r\n        //更新fixed\r\n        for (let node of this.fixedRoot.children) {\r\n            node.getComponent(node.name).onUIChanged();\r\n        }\r\n    },\r\n\r\n    currentUI() {\r\n        let node = this.uiRoot.children[0];\r\n        return node;\r\n    },\r\n\r\n    showPopup: function (name, cb, clean = true) {\r\n        //未加载\r\n        if (!this._Prefabs[name]) {\r\n            this.load(name, function () {\r\n                this.showPopup(name, cb);\r\n            }.bind(this));\r\n            return;\r\n        }\r\n        //已加载\r\n        let node = cc.instantiate(this._Prefabs[name]);\r\n        this.popupRoot.addChild(node);\r\n        //切换场景时不被清理\r\n        if (!clean) {\r\n            node.tag = 10086;\r\n        }\r\n        if (cb) {\r\n            cb(node);\r\n        }\r\n    },\r\n\r\n    getPopup: function (name) {\r\n        return this.popupRoot.getChildByName(name);\r\n    },\r\n\r\n    popPopup: function () {\r\n        let popups = this.popupRoot.children;\r\n        if (popups.length > 0) {\r\n            popups[popups.length - 1].removeFromParent();\r\n        }\r\n    },\r\n\r\n    clearPopup: function (name) {\r\n        for (let node of this.popupRoot.children) {\r\n            if (node.name === name) {\r\n                node.removeFromParent();\r\n            }\r\n        }\r\n    },\r\n\r\n    clearPopups: function () {\r\n        this.popupRoot.removeAllChildren();\r\n    },\r\n\r\n    showToast: function (s) {\r\n        if (!this.toastPrefab) return;\r\n        for (let i in this.toastRoot.children) {\r\n            this.toastRoot.children[i].getComponent('Toast').moveUp();\r\n        }\r\n        let node = cc.instantiate(this.toastPrefab);\r\n        this.toastRoot.addChild(node);\r\n        node.getComponent('Toast').show(s);\r\n    },\r\n\r\n    showLoadingMask: function () {\r\n        this.loadingMask.active = true;\r\n    },\r\n\r\n    hideLoadingMask: function () {\r\n        this.loadingMask.active = false;\r\n    },\r\n\r\n    // 返回键\r\n    onKeyDown: function (event) {\r\n        switch (event.keyCode) {\r\n            case cc.KEY.back:\r\n            case cc.KEY.escape:\r\n                if (this.popupRoot.childrenCount > 0) {\r\n                    this.popPopup();\r\n                }\r\n                else if (GameApp.ui.currentUI().name === 'MainUI'){\r\n                    cc.game.end();\r\n                }\r\n                else {\r\n                    let node = this.fixedRoot.getChildByName('TopFixed');\r\n                    if (node) {\r\n                        node.getComponent(node.name).closeBtn.node.emit('click');\r\n                    }\r\n                }\r\n                break;\r\n        }\r\n    },\r\n});"]}